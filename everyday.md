[TOC]
# 每日一课

## 2020-04-26: 从磁盘的角度聊聊MySql的索引
### mysql InnoDB引擎的数据模型
- mysql的索引是B+树结构, B+树的非叶子节点不保存磁盘数据, 只用来保存索引分叉. 叶子节点中保存了磁盘数据, 且叶子节点之间是相互联通的
- 默认创建主键索引, 主键索引的每个叶子节点保存了该主键值对应的整行记录; 非主键索引的叶子节点保存的索引键的值和其对应的主键值
- 主键索引称为聚族索引, 非主键索引称为二级索引

### 索引是如何提升查询效率的 
- 未创建索引时查询数据需要遍历全表, 时间复杂度位O(n); 使用B+树后, 时间复杂读变为B+树遍历的时间复杂度+ 叶子节点间搜寻数据的时间复杂度, 整体时间复杂度位O(logN)
- B+树每往下遍历一层, 都需要通过磁盘I/O来读取数据, 所以减少B+的树的高度可以减少磁盘I/O的次数, 从而提高效率. 由于索引的非叶子节点是不保存磁盘数据的, 索引非叶子节点可以有更多的空间来保存索引分叉, 所以可以减少B+树的高度, 从而减少I/O次数
- 叶子节点层是相互联通的, 这样的话在非叶子节点层就形成了一个双向链表, 可以对数据进行横向遍历, 进而有利于范围查询, 同样提高了查询效率

### Mysql创建索引的建议
1. InnoDB存储引擎中, 主键尽量避免使用很长的字
2. 在保证索引区分度的情况下, 被索引的字段尽量不要太长
3. 查询中可以利用索引覆盖, 从而避免不必要的回表
4. 不要建立太多的索引
- 第1, 第2两点都是减少非叶子节点上索引的大小, 这样非叶子节点可以保存更多的所以分叉, 从而降低B+树的高度
- 使用主键索引查询时, 由于主键索引中保存了整行的记录, 所以不存在回表的说法; 而二级所以中只保存了当前索引键的值和主键值, 如果查询的列不是索引键, 则需要拿主键ID去查询主键索引B+树获取数据, 这称为回表. 查询时如果需要查询的列小于等于索引的键, 则不需要回表, 这称为覆盖索引
- 索引的数量越多, 当进行表更新时, 索引表的更新操作会浪费更多的I/O, 而且在区分度不高的列创建索引不仅不会提升效率, 还会因为索引表的更新而拖慢数据的更新操作. 所以不要创建太多的索引
- 索引的区分度 = 不重复的记录数/总记录数; 索引区分度的值在(0,1]之间, 这个值越接近于1, 则索引的使用价值越高











