[TOC]
# 研发效能

## 相关概念

### 研发效能的定义, 模型
- 定义: 团队能够持续地为客户产生有效价值的效率
- 包括有效性, 效率, 可持续性三个方面, 三者必须兼顾
    1. 有效性, 产品对公司和客户一定是有价值的, 否决做出来也是白做, 浪费资源
    2. 效率, 指的是速度, 正确性, 在一定的时间内产出越多, 效率越高
    3. 可持续性, 高效的产出要有持续性, 否决短期的高产出可能会影响到长期的产出, 比如短期突击加班带来的身体问题导致后续工作效率低下

### 为什么要关注研发效能
- 业务发展迅速, 工作量不断加大, 传统的堆人, 加班堆工时的方法和会不断的扩大人力成本, 消耗开发人员的精力和积极性, 而且由于人员越来越多, 相互之间沟通的成本会越来越大, 出现问题的几率也会大很多
- 研发效能的提高能让开发着更效率的产生价值, 能容易精进自己的技术, 团队更有经历和好的开发氛围, 从而支撑持续的高效开发

### 如何度量研发效能
- 软件开发和传统制造业类似, 大致流程都是流水线作业.软件开发可以分为产品, 开发, 测试, 运维等多个不同的节点, 但与传统制造业不同, 软件开发有其本身的灵活性, 总结来说,研发效能的本质就是一条超级灵活的流水线
- 和传统制造业相比, 软件开发具有超强的灵活性, 主要体现在四个方面
    1. 最终产品目标的灵活性, 其产品的最终形态是在不断迭代中确定的, 不是一成不变的
    2. 节点之间的灵活性, 多个节点可以相互融合
    3. 每个节点有自己的灵活性, 比如测试节点就有各自不同的测试方法
    4. 每个节点上开发人员的灵活性
    - 根据不同的灵活性, 需要提高相应的效能, 针对1, 2需要提高流程的效能; 针对3不同的节点采用不同的工程方法, 提高效能; 针对4提高个人的效能
- 彼得.得鲁克: 一个事物,你如果无法度量它, 就无法管理它.(If you can't measure it, you can't manage it)
- 度量研发效能的目的
    1. 跟踪团队表现, 提高团队效率
    2. 提高项目计划的精准度
    3. 了解流程是否高效, 寻找需要改进的关键领域
- 研发效能难以度量的原因
    1. 软件开发工作是一项创造性很强的知识性工作, 非常复杂且伴随有大量不确定因素
    2. 很多公司存在竖井效应, 常常将注意力放在某一两个竖井中, 进行局部优化. 但是局部优化并不代表全局优化, 甚至会让全局恶化
    3. 度量指标一般是用来度量软件生产过程和产品质量的, 但是公司真正需要关注的是产品能否解决用户问题, 是否能为客户产生价值. 这就涉及技术产品输出和用户价值输出之间的壁垒问题
    4. 收集数据的难易程度不同, 收集的数据容易数据化, 使得效能度量成为数字游戏
    5. 软件开发和实践存在滞后效应, 比如codeReview刚开始没有什么效果, 正面效果可能需要一两个月才能展现出来
- 效能度量的推荐方法, 关键点:不和绩效挂钩
    1. 目标驱动, 度量对的事情. 比如和产品价值强关联的, 应用十分可用, 线上问题十分及时处理, 紧急bug修复耗时等, 可以有以下几个度量指标
        - 净推荐值(NPS, Net Promoter Score)
        - 应用宕机时间和严重线上事故数
        - 热修复上线时间
    2. 通过主观的方式来评价, 提高效能
    3. 关注个人维度的指标
- 可以使用的方法
    1. 从全局找瓶颈, 不要以局部推断全局, 而是先获取全局信息, 找到瓶颈所在, 再优化瓶颈
    2. 关注并优化解决影响个人开发维度的问题, 比如本地启动效率, 协调机制的健全
        
## 研发效能实践

### 研发流程

#### 流程优化, 如何使用敏捷和精益
- 使用方法论的方式
    1. 中心目标基本不会有问题, 
    2. 原则的通用性差一些, 需要在理解的基础上选择和是自己和自己团队的
    3. 具体三时间时, 要根据自己团队的特点选择合适 的时间方式, 切不可生搬硬套
    4. 使用why-how-what的三w方法来实现, 在引入实践时, 逐步优化已有的开发流程和框架, 可以只给出原则, 然后让团队成员自己摸索并最终找到合适的方法

- 提高研发效能流程的目标, 原则和实践
    1. 目标一: 寻找用户价值, 只有对的产品才能生存下去, 这一条也是提高寻找用户价值的效率:
        1. 原则1:衡量每一个时间段成果的标准, 应该是价值假设方面的进展, 即为客户提供了多少价值, 而不是开发了多少功能 
        2. 原则2: 使用最小可行性产品来验证, 这里的产品可以是应用中的一个小功能, 只要能形成一个闭环就可以认为是一个产品. 可以提前计划好要验证哪些假设, 需要收集什么样的数据才能验证这些假设, 功能上线后就可以收集这些数据, 一旦发现收集的数据显示不能为客户提供足够的价值, 则放弃此产品
    2. 目标二: 提高用户价值的流动效率, 也就是提高研发留存各节点之间的流动效率
        1. 原则1:让功能尽快的流动.需要开发人员尽量将需求拆分, 在完成一个提交之后尽快提交
        2. 原则2:让节点之间的联动更加顺畅. 具体时间就是CICD, 其中CI至关重要
        3. 原则3:节点间的融合. 职能团队需要提供平台和工具, 让功能在节点间的流动更加的顺畅. 如果有全栈工程师的话, 要做到让全栈工程师能自己处理端到端的工作
        4. 发现整个流程中的瓶颈, 并解决它们. 具体实践有可视化和复盘
        - 第一步: 找到系统中的瓶颈
        - 第二步: 最大限度的利用瓶颈, 尽量通过提高效能的办法解决瓶颈
        - 第三步: 让企业的所有其他活动都让步于瓶颈改善工作
        - 第四步: 打破瓶颈, 如果第二, 三步无效, 就通过给瓶颈节点增加资源的方法来解决瓶颈
        - 第五步: 重返第一步, 找出新的瓶颈, 持续改善

#### 代码入库前的流程优(**持续开发**)
- 代码入库前都是由开发人员来操作的, 具体的流程有本地环境搭建, 编码, 调试, 静态检查, 自动化测试, 代码审查几个阶段. 具体工作内容可以分为开发人员实际编码和为保证代码质量进行的各种检查两个部分. 为了提高这两个部分的效率, 有两个指导的原则,一是自动化各类检查,快速反馈检查结果; 二是提高编码过程中的效率, 可以使用实时代码检查, 缩短本地编译,调试实践等方式来实现
- 持续开发: 开发人员可以不受阻碍, 不受不必要的干扰, 从而全身心的聚焦在产品开发上
- 持续开发的原则
    1. 规范化, 自动化核心步骤
    2. 快速反馈, 增量开发
- 规范化, 自动化核心步骤
    1. 提高开发环境的获取效率. 操作次此步骤的机会不多, 但是如果很复杂的化会很麻烦. 可以使用的方法有使用虚拟化机器快速生成开发环境, 可以使用Terraform工具; 也可以提供机器镜像和配置脚本来完成自动化的环境构建工作
    2. 规范化,自动化本地检查.在开发机器上进行验证, 比如语法检查, 规范检查, 单元测试, 沙盒搭建等.最好是使用统一的工具和配置, 让团队成员统一使用
    3. 建设并自动化代码入库前的检查流程. 需要在代码入库前作必要的检查工作. 比如编译检查, 代码格式检查, 重要的单元测试检查等,它起到一个门禁的作用 
- 提供快速反馈, 促进增量开发. 边开发,边验证, 提升效率
    1. 灵活使用各种Linter(语法检查之类的小工具)和测试
    2. 建设并本地调试环境. 包括增量的构建, 测试数据的产生
    3. 使用事实检测工具. 包括IDE的自动检测, 热部署, 实施编译等措施
    - 最大的好处就是可以能够大大提高开发者对当前代码的信心, 从而促进代码尽早入仓, 尽早集成
- 总结: 快速获取开发环境. 提升本地编码的非开发工作效率尽量使其自动化, 在代码入仓前作代码检查.本地测试, 本地检查, 入口前的检查都快速反馈给开发人员
- 开发人员是编码第一线的战斗人员, 他们最清楚痛点在哪, 开发人员需要自己花一定实践来优化自己的开发流程并可以与其他人分享共同进步, 管理者也需要对这些解决了问题的开发人员和方案进行适当的奖励以提升其积极性,相互影响, 才能更好的提升效率

#### 代码入库后的操作(持续集成, 持续部署, 持续交付)
- 持续集成的目的就是代码要及时的合并.定义: 在团队协作中, 一天内多次将所有开发人员的代码合并入同一条主干. 有两个需要注意的问题
    1. 需要流程尽量的频繁, 这样的话可以将小的提交快速的通过产品流水线发布到生产中, 以最快的速度试错, 从而为客户提供有价值的功能
    2. 在发布到不同环境的过程中的时候, 会发现不同的问题, 提前发现这些问题, 也有利于提升产品上线的效率
- 持续集成, 持续交付, 持续部署
    1. 从本地开发结束到代码部署到测试环境,是持续集成的过程, 包括代码检查, 自动化测试, 自动化构建等过程
    2. 从测试环境开始到代码进入到进入生产环境之前称为持续交付过程, 包括测试, 集成测试, 压力测试等其他过程
    3. 从类生产环境发布到生产环境, 当类生产环境验证完成若自动化部署到生产环境则称为持续部署
- 持续部署是发布到生产环境的最后一步, 所以持续集成/持续交付是核心的内容称为"CI/CD"
- CI/CD流水线的具体原则以及最佳实践
    - 流水线的测试要尽量完整
        1. 流程越完整, 代码和产品的质量才能有保证, 包括单元测试, 集成测试, 安全扫描, 性能测试等. 如果测试的时候发现问题的话, 开发人员还要考虑十分需要为此次失败添加新的测试用例来防止此类错误再次发生
    - 流水线的运行速度一定要快
        1. 流水线的速度一定要快, 只有速度够快, 才能支持大量的流程验证任务, 可以从以下几个角度来提升速度
            - 使用并行的方式运行各种测试来提速
            - 投入硬件资源, 使用水平扩展的方式来提速
            - 使用增量测试的方式进行精准验证. 也就是说, 只运行跟当前改动最相关的测试, 以减少测试用例的运行数量
            - 提交数量较多时, 只运行优先级较高的, 重要性比较高的测试, 和改动相关的测试. 到系统不繁忙的时候运行全量的检测案例
            - 让开发人员可以在本地机器上调用远程机器的测试用例, 使开发人员在本地开发的过程中就可以检测改动对测试用例的影响, 及早发现问题, 及早修复
    - 流水线使用的环境, 尽量和生产环境一致, 尽量减少因为环境不一致导致的发布失败,这样很不划算
        1. 软件包最好只构建一次, 保证不同的环境都使用同一个包. 如果不同的环境打包参数不一样, 可以采用环境变量的方式把这些参数传递给软件包
        2. 使用Docker镜像的方式, 把发布的产品以及环境都打包进去, 实现环境的一致性
        3. 尽量使用比较干净的环境, 防止以前的环境残留对本次部署产生影响. 可以使用新生成的环境, 也可以在每次部署完成后对环境进行清扫
    - 在CI/CD的过程中, 切不可教条主义的生般硬套, 要根据自身开发,测试,运维人员的技术水平, 自己本身的业务特点来灵活的使用. CI/CD的本质目的是希望让功能快速的通过流水线以到达发布的状态. 但是发布的间隔是可以自己把握的. 比如不需要每一个提交都持续交付, 可以是定时, 或者是每天一次. 只要找到合适自己和团队的节奏就是号的实践

#### 分支管理


#### DevOps

#### 团队协同

### 工程方法
#### 开发
#### 测试
#### 运维
### 个人效能
#### 深度工作
#### git
#### 命令行
#### vim
#### 工具环境集成
### 效能文化
#### 硅谷的管理和文化
